<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chinancué˜¿æ‹‰ä¼¯è¯­èƒŒå•è¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2rem;
            color: #e94560;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .arabic-word {
            font-size: 4.5rem;
            text-align: center;
            margin: 20px 0;
            color: #ffd700;
            direction: rtl;
            line-height: 1.5;
            font-family: 'Traditional Arabic', 'Arabic Typesetting', 'Scheherazade', serif;
        }

        .transliteration {
            text-align: center;
            font-size: 1.5rem;
            color: #00d9ff;
            margin-bottom: 15px;
            font-style: italic;
        }

        .phonetic {
            text-align: center;
            font-size: 1rem;
            color: #b0d8ff;
            margin-bottom: 15px;
        }

        .chinese-meaning {
            text-align: center;
            font-size: 2.2rem;
            color: #fff;
            margin-bottom: 10px;
        }

        .english-meaning {
            text-align: center;
            font-size: 1.2rem;
            color: #a0a0a0;
            margin-bottom: 20px;
        }

        .category-badge {
            display: inline-block;
            background: #e94560;
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-play {
            background: linear-gradient(45deg, #00d9ff, #0099cc);
            color: #fff;
        }

        .btn-play:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0,217,255,0.4);
        }

        .btn-refresh {
            background: linear-gradient(45deg, #e94560, #c73e54);
            color: #fff;
        }

        .btn-refresh:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(233,69,96,0.4);
        }

        .btn-auto {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #1a1a2e;
        }

        .btn-auto.active {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
        }

        .btn-auto:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255,215,0,0.4);
        }

        .btn-mastered {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: #fff;
        }

        .btn-mastered:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(155,89,182,0.4);
        }

        .btn-review {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: #fff;
        }

        .btn-review:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(52,152,219,0.4);
        }

        .settings {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .settings h3 {
            margin-bottom: 15px;
            color: #ffd700;
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .setting-row label {
            color: #a0a0a0;
        }

        .setting-row input[type="range"] {
            width: 150px;
        }

        .setting-row select {
            padding: 8px 15px;
            border-radius: 10px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .setting-row select option {
            background: #1a1a2e;
            color: #fff;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e94560, #ffd700);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            min-width: 80px;
        }

        .stat-number {
            font-size: 1.8rem;
            color: #ffd700;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #a0a0a0;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #e94560;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* å¼€è½¦æ¨¡å¼ - å¤§æŒ‰é’® */
        .driving-mode .btn {
            padding: 25px 50px;
            font-size: 1.5rem;
        }

        .driving-mode .arabic-word {
            font-size: 6rem;
        }

        .driving-mode .chinese-meaning {
            font-size: 3rem;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.5rem;
            }

            .arabic-word {
                font-size: 3rem;
            }

            .chinese-meaning {
                font-size: 1.5rem;
            }

            .btn {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .card {
                padding: 20px;
            }

            .stat-number {
                font-size: 1.3rem;
            }
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speed-value {
            min-width: 40px;
            text-align: center;
            color: #ffd700;
        }

        /* æ’­æ”¾çŠ¶æ€æŒ‡ç¤º */
        .playing {
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .word-counter {
            text-align: center;
            color: #a0a0a0;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        /* å·²æŒæ¡å•è¯åˆ—è¡¨ */
        .mastered-section {
            margin-top: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .mastered-section h3 {
            color: #9b59b6;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mastered-list {
            max-height: 200px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .mastered-item {
            background: rgba(155,89,182,0.2);
            border: 1px solid rgba(155,89,182,0.4);
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mastered-item .arabic {
            color: #ffd700;
            direction: rtl;
        }

        .mastered-item .chinese {
            color: #a0a0a0;
        }

        .mastered-item .remove-btn {
            background: none;
            border: none;
            color: #e94560;
            cursor: pointer;
            font-size: 1rem;
            padding: 0 5px;
        }

        .mastered-item .remove-btn:hover {
            color: #ff6b6b;
        }

        .clear-btn {
            background: rgba(233,69,96,0.2);
            border: 1px solid #e94560;
            color: #e94560;
            padding: 5px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .clear-btn:hover {
            background: rgba(233,69,96,0.4);
        }

        .category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .category-btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            color: #fff;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .category-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .category-btn.active {
            background: #e94560;
            border-color: #e94560;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 15px 30px;
            border-radius: 10px;
            z-index: 1000;
            display: none;
        }

        .toast.show {
            display: block;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            20% { opacity: 1; transform: translateX(-50%) translateY(0); }
            80% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>chinancué˜¿æ‹‰ä¼¯è¯­èƒŒå•è¯</h1>
            <p class="subtitle">æ ‡å‡†é˜¿æ‹‰ä¼¯è¯­ (MSA) | å¼€è½¦å¬å•è¯ | è“ç‰™è¯­éŸ³å­¦ä¹ </p>
        </header>

        <div class="category-selector" id="category-selector">
            <button class="category-btn active" data-category="all">å…¨éƒ¨</button>
            <button class="category-btn" data-category="greetings">é—®å€™è¯­</button>
            <button class="category-btn" data-category="numbers">æ•°å­—</button>
            <button class="category-btn" data-category="family">å®¶åº­</button>
            <button class="category-btn" data-category="food_and_drink">é£Ÿç‰©</button>
            <button class="category-btn" data-category="colors">é¢œè‰²</button>
            <button class="category-btn" data-category="animals">åŠ¨ç‰©</button>
            <button class="category-btn" data-category="body">èº«ä½“</button>
            <button class="category-btn" data-category="time">æ—¶é—´</button>
            <button class="category-btn" data-category="verbs">åŠ¨è¯</button>
            <button class="category-btn" data-category="adjectives">å½¢å®¹è¯</button>
        </div>

        <div class="card" id="word-card">
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨åŠ è½½å•è¯...</p>
            </div>
            <div id="word-content" style="display:none;">
                <div style="text-align:center;">
                    <span class="category-badge" id="category">åŠ è½½ä¸­...</span>
                </div>
                <div class="arabic-word" id="arabic-word">Ù…Ø±Ø­Ø¨Ø§</div>
                <div class="transliteration" id="transliteration">marhaba</div>
                <div class="phonetic" id="phonetic">/marhaban/</div>
                <div class="chinese-meaning" id="chinese-meaning">ä½ å¥½</div>
                <div class="english-meaning" id="english-meaning">Hello</div>
                <div class="word-counter" id="word-counter">ç¬¬ 1 ä¸ªå•è¯</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-play" id="btn-play-arabic" onclick="playArabic()">
                ğŸ”Š é˜¿æ‹‰ä¼¯è¯­
            </button>
            <button class="btn btn-play" id="btn-play-chinese" onclick="playChinese()">
                ğŸ—£ï¸ ä¸­æ–‡
            </button>
            <button class="btn btn-refresh" onclick="loadNewWord()">
                ğŸ”„ ä¸‹ä¸€ä¸ª
            </button>
            <button class="btn btn-mastered" onclick="markAsMastered()">
                âœ… å·²æŒæ¡
            </button>
            <button class="btn btn-auto" id="btn-auto" onclick="toggleAutoPlay()">
                â–¶ï¸ è‡ªåŠ¨æ’­æ”¾
            </button>
        </div>

        <div class="settings">
            <h3>âš™ï¸ è®¾ç½®</h3>
            <div class="setting-row">
                <label>è‡ªåŠ¨æ’­æ”¾é—´éš”ï¼š</label>
                <div class="speed-control">
                    <input type="range" id="interval-slider" min="3" max="15" value="6" onchange="updateInterval()">
                    <span class="speed-value" id="interval-value">6ç§’</span>
                </div>
            </div>
            <div class="setting-row">
                <label>è¯­é€Ÿï¼š</label>
                <div class="speed-control">
                    <input type="range" id="speed-slider" min="0.5" max="1.2" step="0.1" value="0.7" onchange="updateSpeed()">
                    <span class="speed-value" id="speed-value">0.7x</span>
                </div>
            </div>
            <div class="setting-row">
                <label>æ’­æ”¾æ¨¡å¼ï¼š</label>
                <select id="play-mode" onchange="updatePlayMode()">
                    <option value="arabic-chinese">å…ˆé˜¿æ‹‰ä¼¯è¯­åä¸­æ–‡</option>
                    <option value="chinese-arabic">å…ˆä¸­æ–‡åé˜¿æ‹‰ä¼¯è¯­</option>
                    <option value="arabic-only">ä»…é˜¿æ‹‰ä¼¯è¯­</option>
                    <option value="all">å…¨éƒ¨(é˜¿+è‹±+ä¸­)</option>
                </select>
            </div>
            <div class="setting-row">
                <label>å¼€è½¦æ¨¡å¼ï¼ˆå¤§å­—ä½“ï¼‰ï¼š</label>
                <button class="category-btn" id="driving-mode-btn" onclick="toggleDrivingMode()">å…³é—­</button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="mastered-count">0</div>
                <div class="stat-label">å·²æŒæ¡</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="remaining-count">0</div>
                <div class="stat-label">å¾…å­¦ä¹ </div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="session-count">0</div>
                <div class="stat-label">æœ¬æ¬¡å­¦ä¹ </div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="total-count">0</div>
                <div class="stat-label">æ€»è¯æ±‡</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>

        <div class="mastered-section">
            <h3>
                <span>ğŸ“š å·²æŒæ¡çš„å•è¯</span>
                <button class="clear-btn" onclick="clearMastered()">æ¸…ç©º</button>
            </h3>
            <div class="mastered-list" id="mastered-list">
                <p style="color:#a0a0a0;">è¿˜æ²¡æœ‰æŒæ¡çš„å•è¯ï¼Œç‚¹å‡»"å·²æŒæ¡"æ·»åŠ </p>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // è¯æ±‡æ•°æ®æ¥æºï¼ˆGitHubï¼‰
        const WORDS_URL = 'https://raw.githubusercontent.com/ismael-almaali/arabic-vocab-for-api/main/word-list.json';

        // MSAåˆ†ç±»
        const msaCategories = ['adjectives', 'adverbs', 'animals', 'body', 'colors', 'family', 'food_and_drink', 'greetings', 'house', 'nature', 'numbers', 'occupations', 'phrases', 'pronouns', 'questions', 'school', 'time', 'transportation', 'verbs', 'weather'];

        // åˆ†ç±»ä¸­æ–‡ç¿»è¯‘
        const categoryTranslations = {
            'adjectives': 'å½¢å®¹è¯',
            'adverbs': 'å‰¯è¯',
            'animals': 'åŠ¨ç‰©',
            'body': 'èº«ä½“éƒ¨ä½',
            'colors': 'é¢œè‰²',
            'family': 'å®¶åº­',
            'food_and_drink': 'é£Ÿç‰©é¥®å“',
            'greetings': 'é—®å€™è¯­',
            'house': 'æˆ¿å±‹',
            'nature': 'è‡ªç„¶',
            'numbers': 'æ•°å­—',
            'occupations': 'èŒä¸š',
            'phrases': 'çŸ­è¯­',
            'pronouns': 'ä»£è¯',
            'questions': 'ç–‘é—®è¯',
            'school': 'å­¦æ ¡',
            'time': 'æ—¶é—´',
            'transportation': 'äº¤é€š',
            'verbs': 'åŠ¨è¯',
            'weather': 'å¤©æ°”',
            'general': 'è¯æ±‡',
            'all': 'å…¨éƒ¨'
        };

        // è‹±æ–‡åˆ°ä¸­æ–‡ç¿»è¯‘
        const englishToChineseMap = {
            'hello': 'ä½ å¥½', 'hi': 'ä½ å¥½', 'goodbye': 'å†è§', 'good morning': 'æ—©ä¸Šå¥½',
            'good evening': 'æ™šä¸Šå¥½', 'good night': 'æ™šå®‰', 'welcome': 'æ¬¢è¿',
            'thank you': 'è°¢è°¢', 'thanks': 'è°¢è°¢', 'please': 'è¯·', 'sorry': 'å¯¹ä¸èµ·',
            'excuse me': 'æ‰“æ‰°ä¸€ä¸‹', 'yes': 'æ˜¯', 'no': 'ä¸', 'ok': 'å¥½çš„',
            'one': 'ä¸€', 'two': 'äºŒ', 'three': 'ä¸‰', 'four': 'å››', 'five': 'äº”',
            'six': 'å…­', 'seven': 'ä¸ƒ', 'eight': 'å…«', 'nine': 'ä¹', 'ten': 'å',
            'zero': 'é›¶', 'hundred': 'ç™¾', 'thousand': 'åƒ', 'first': 'ç¬¬ä¸€',
            'second': 'ç¬¬äºŒ', 'third': 'ç¬¬ä¸‰',
            'red': 'çº¢è‰²', 'blue': 'è“è‰²', 'green': 'ç»¿è‰²', 'yellow': 'é»„è‰²',
            'black': 'é»‘è‰²', 'white': 'ç™½è‰²', 'orange': 'æ©™è‰²', 'purple': 'ç´«è‰²',
            'pink': 'ç²‰è‰²', 'brown': 'æ£•è‰²', 'gray': 'ç°è‰²', 'grey': 'ç°è‰²',
            'father': 'çˆ¶äº²', 'mother': 'æ¯äº²', 'son': 'å„¿å­', 'daughter': 'å¥³å„¿',
            'brother': 'å…„å¼Ÿ', 'sister': 'å§å¦¹', 'grandfather': 'ç¥–çˆ¶',
            'grandmother': 'ç¥–æ¯', 'uncle': 'å”å”', 'aunt': 'é˜¿å§¨',
            'husband': 'ä¸ˆå¤«', 'wife': 'å¦»å­', 'family': 'å®¶åº­', 'child': 'å­©å­',
            'children': 'å­©å­ä»¬', 'baby': 'å©´å„¿', 'parent': 'çˆ¶æ¯', 'parents': 'çˆ¶æ¯',
            'cat': 'çŒ«', 'dog': 'ç‹—', 'bird': 'é¸Ÿ', 'fish': 'é±¼', 'horse': 'é©¬',
            'cow': 'ç‰›', 'sheep': 'ç¾Š', 'goat': 'å±±ç¾Š', 'chicken': 'é¸¡', 'duck': 'é¸­',
            'lion': 'ç‹®å­', 'tiger': 'è€è™', 'elephant': 'å¤§è±¡', 'monkey': 'çŒ´å­',
            'rabbit': 'å…”å­', 'mouse': 'è€é¼ ', 'snake': 'è›‡', 'camel': 'éª†é©¼',
            'donkey': 'é©´', 'wolf': 'ç‹¼', 'bear': 'ç†Š', 'deer': 'é¹¿',
            'water': 'æ°´', 'bread': 'é¢åŒ…', 'rice': 'ç±³é¥­', 'meat': 'è‚‰',
            'egg': 'é¸¡è›‹', 'milk': 'ç‰›å¥¶', 'coffee': 'å’–å•¡', 'tea': 'èŒ¶',
            'juice': 'æœæ±', 'fruit': 'æ°´æœ', 'apple': 'è‹¹æœ', 'banana': 'é¦™è•‰',
            'vegetable': 'è”¬èœ', 'tomato': 'ç•ªèŒ„', 'potato': 'åœŸè±†', 'onion': 'æ´‹è‘±',
            'sugar': 'ç³–', 'salt': 'ç›', 'oil': 'æ²¹', 'butter': 'é»„æ²¹',
            'cheese': 'å¥¶é…ª', 'soup': 'æ±¤', 'salad': 'æ²™æ‹‰', 'food': 'é£Ÿç‰©',
            'head': 'å¤´', 'face': 'è„¸', 'eye': 'çœ¼ç›', 'eyes': 'çœ¼ç›',
            'ear': 'è€³æœµ', 'ears': 'è€³æœµ', 'nose': 'é¼»å­', 'mouth': 'å˜´',
            'tooth': 'ç‰™é½¿', 'teeth': 'ç‰™é½¿', 'tongue': 'èˆŒå¤´', 'hair': 'å¤´å‘',
            'hand': 'æ‰‹', 'hands': 'æ‰‹', 'finger': 'æ‰‹æŒ‡', 'arm': 'æ‰‹è‡‚',
            'leg': 'è…¿', 'foot': 'è„š', 'feet': 'è„š', 'heart': 'å¿ƒè„',
            'stomach': 'èƒƒ', 'back': 'èƒŒ', 'neck': 'è„–å­', 'shoulder': 'è‚©è†€',
            'today': 'ä»Šå¤©', 'tomorrow': 'æ˜å¤©', 'yesterday': 'æ˜¨å¤©', 'now': 'ç°åœ¨',
            'morning': 'æ—©ä¸Š', 'afternoon': 'ä¸‹åˆ', 'evening': 'æ™šä¸Š', 'night': 'å¤œæ™š',
            'day': 'å¤©', 'week': 'å‘¨', 'month': 'æœˆ', 'year': 'å¹´',
            'hour': 'å°æ—¶', 'minute': 'åˆ†é’Ÿ', 'time': 'æ—¶é—´',
            'sun': 'å¤ªé˜³', 'moon': 'æœˆäº®', 'star': 'æ˜Ÿæ˜Ÿ', 'cloud': 'äº‘',
            'rain': 'é›¨', 'snow': 'é›ª', 'wind': 'é£', 'hot': 'çƒ­', 'cold': 'å†·',
            'warm': 'æ¸©æš–', 'weather': 'å¤©æ°”',
            'good': 'å¥½', 'bad': 'å', 'big': 'å¤§', 'small': 'å°', 'large': 'å¤§çš„',
            'little': 'å°çš„', 'tall': 'é«˜', 'short': 'çŸ®/çŸ­', 'long': 'é•¿',
            'new': 'æ–°', 'old': 'æ—§/è€', 'young': 'å¹´è½»', 'beautiful': 'ç¾ä¸½',
            'happy': 'å¿«ä¹', 'sad': 'æ‚²ä¼¤', 'angry': 'ç”Ÿæ°”', 'tired': 'ç´¯',
            'hungry': 'é¥¿', 'thirsty': 'æ¸´', 'sick': 'ç”Ÿç—…', 'healthy': 'å¥åº·',
            'fast': 'å¿«', 'slow': 'æ…¢', 'easy': 'å®¹æ˜“', 'difficult': 'å›°éš¾',
            'clean': 'å¹²å‡€', 'dirty': 'è„', 'full': 'æ»¡', 'empty': 'ç©º',
            'heavy': 'é‡', 'light': 'è½»', 'strong': 'å¼º', 'weak': 'å¼±',
            'important': 'é‡è¦', 'delicious': 'ç¾å‘³', 'expensive': 'è´µ', 'cheap': 'ä¾¿å®œ',
            'eat': 'åƒ', 'drink': 'å–', 'sleep': 'ç¡è§‰', 'walk': 'èµ°', 'run': 'è·‘',
            'sit': 'å', 'stand': 'ç«™', 'go': 'å»', 'come': 'æ¥', 'see': 'çœ‹',
            'hear': 'å¬', 'speak': 'è¯´', 'talk': 'è°ˆè¯', 'read': 'è¯»', 'write': 'å†™',
            'work': 'å·¥ä½œ', 'study': 'å­¦ä¹ ', 'learn': 'å­¦ä¹ ', 'teach': 'æ•™',
            'know': 'çŸ¥é“', 'think': 'æƒ³', 'want': 'æƒ³è¦', 'need': 'éœ€è¦',
            'like': 'å–œæ¬¢', 'love': 'çˆ±', 'help': 'å¸®åŠ©', 'give': 'ç»™', 'take': 'æ‹¿',
            'buy': 'ä¹°', 'sell': 'å–', 'pay': 'ä»˜é’±', 'open': 'æ‰“å¼€', 'close': 'å…³é—­',
            'start': 'å¼€å§‹', 'stop': 'åœæ­¢', 'finish': 'å®Œæˆ', 'wait': 'ç­‰å¾…',
            'play': 'ç©', 'cook': 'åšé¥­', 'wash': 'æ´—', 'drive': 'å¼€è½¦',
            'fly': 'é£', 'swim': 'æ¸¸æ³³', 'live': 'ä½', 'laugh': 'ç¬‘', 'cry': 'å“­',
            'house': 'æˆ¿å­', 'home': 'å®¶', 'room': 'æˆ¿é—´', 'door': 'é—¨',
            'window': 'çª—æˆ·', 'kitchen': 'å¨æˆ¿', 'bathroom': 'æµ´å®¤',
            'school': 'å­¦æ ¡', 'hospital': 'åŒ»é™¢', 'market': 'å¸‚åœº', 'shop': 'å•†åº—',
            'restaurant': 'é¤å…', 'hotel': 'é…’åº—', 'street': 'è¡—é“', 'city': 'åŸå¸‚',
            'country': 'å›½å®¶', 'mountain': 'å±±', 'river': 'æ²³', 'sea': 'æµ·',
            'car': 'æ±½è½¦', 'bus': 'å…¬äº¤è½¦', 'train': 'ç«è½¦', 'plane': 'é£æœº',
            'ship': 'èˆ¹', 'bicycle': 'è‡ªè¡Œè½¦', 'taxi': 'å‡ºç§Ÿè½¦',
            'teacher': 'è€å¸ˆ', 'doctor': 'åŒ»ç”Ÿ', 'engineer': 'å·¥ç¨‹å¸ˆ',
            'student': 'å­¦ç”Ÿ', 'driver': 'å¸æœº', 'farmer': 'å†œæ°‘', 'worker': 'å·¥äºº',
            'man': 'ç”·äºº', 'woman': 'å¥³äºº', 'boy': 'ç”·å­©', 'girl': 'å¥³å­©',
            'person': 'äºº', 'people': 'äººä»¬', 'friend': 'æœ‹å‹', 'name': 'åå­—',
            'book': 'ä¹¦', 'pen': 'ç¬”', 'paper': 'çº¸', 'phone': 'ç”µè¯',
            'money': 'é’±', 'thing': 'ä¸œè¥¿', 'place': 'åœ°æ–¹', 'world': 'ä¸–ç•Œ',
            'life': 'ç”Ÿæ´»', 'peace': 'å’Œå¹³', 'god': 'çœŸä¸»', 'allah': 'çœŸä¸»',
            'prayer': 'ç¥ˆç¥·', 'how': 'æ€ä¹ˆ', 'what': 'ä»€ä¹ˆ', 'where': 'å“ªé‡Œ',
            'when': 'ä»€ä¹ˆæ—¶å€™', 'who': 'è°', 'why': 'ä¸ºä»€ä¹ˆ', 'which': 'å“ªä¸ª',
            'this': 'è¿™ä¸ª', 'that': 'é‚£ä¸ª', 'here': 'è¿™é‡Œ', 'there': 'é‚£é‡Œ',
            'very': 'éå¸¸', 'also': 'ä¹Ÿ', 'only': 'åª', 'all': 'æ‰€æœ‰',
            'some': 'ä¸€äº›', 'many': 'å¾ˆå¤š', 'much': 'å¾ˆå¤š', 'more': 'æ›´å¤š',
            'i': 'æˆ‘', 'you': 'ä½ ', 'he': 'ä»–', 'she': 'å¥¹', 'it': 'å®ƒ',
            'we': 'æˆ‘ä»¬', 'they': 'ä»–ä»¬', 'my': 'æˆ‘çš„', 'your': 'ä½ çš„',
            'his': 'ä»–çš„', 'her': 'å¥¹çš„', 'our': 'æˆ‘ä»¬çš„', 'their': 'ä»–ä»¬çš„',
            'and': 'å’Œ', 'or': 'æˆ–', 'but': 'ä½†æ˜¯', 'because': 'å› ä¸º',
            'if': 'å¦‚æœ', 'then': 'ç„¶å', 'so': 'æ‰€ä»¥', 'not': 'ä¸',
            'left': 'å·¦', 'right': 'å³', 'up': 'ä¸Š', 'down': 'ä¸‹',
            'north': 'åŒ—', 'south': 'å—', 'east': 'ä¸œ', 'west': 'è¥¿'
        };

        // çŠ¶æ€å˜é‡
        let currentCategory = 'all';
        let currentWord = null;
        let allWords = [];
        let wordCache = [];
        let autoPlayTimer = null;
        let isAutoPlaying = false;
        let playInterval = 6;
        let speechRate = 0.7;
        let playMode = 'arabic-chinese';
        let sessionCount = 0;
        let isDrivingMode = false;
        const audioPlayer = new Audio();
        audioPlayer.preload = 'auto';

        // å·²æŒæ¡çš„å•è¯ï¼ˆå­˜å‚¨åœ¨localStorageï¼‰
        let masteredWords = JSON.parse(localStorage.getItem('masteredWords') || '[]');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadAllWords();
            setupCategoryButtons();
            updateMasteredList();
            updateStats();
        });

        // è®¾ç½®åˆ†ç±»æŒ‰é’®
        function setupCategoryButtons() {
            document.querySelectorAll('.category-btn[data-category]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-btn[data-category]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    filterWords();
                    displayRandomWord();
                });
            });
        }

        // åŠ è½½æ‰€æœ‰MSAè¯æ±‡
        async function loadAllWords() {
            showLoading(true);
            allWords = [];

            try {
                const response = await fetch(WORDS_URL);
                const words = response.ok ? await response.json() : [];
                if (Array.isArray(words)) {
                    words.forEach(word => {
                        allWords.push({
                            arabic: word.arabic,
                            english: word.english,
                            source: 'general'
                        });
                    });
                }

                if (allWords.length === 0) {
                    useFallbackData();
                } else {
                    updateCategoryAvailability();
                    filterWords();
                    displayRandomWord();
                }
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                useFallbackData();
            }

            updateStats();
        }

        function updateCategoryAvailability() {
            const hasCategories = allWords.some(word => word.source && word.source !== 'general');
            const selector = document.getElementById('category-selector');
            selector.style.display = hasCategories ? 'flex' : 'none';
            if (!hasCategories) {
                currentCategory = 'all';
            }
        }

        // å¤‡ç”¨æ•°æ®
        function useFallbackData() {
            allWords = [
                { arabic: 'Ù…ÙØ±Ù’Ø­ÙØ¨Ù‹Ø§', english: 'Hello', transliteration: 'marhaban', source: 'greetings' },
                { arabic: 'Ø´ÙÙƒÙ’Ø±Ù‹Ø§', english: 'Thank you', transliteration: 'shukran', source: 'greetings' },
                { arabic: 'Ù†ÙØ¹ÙÙ…', english: 'Yes', transliteration: 'na\'am', source: 'phrases' },
                { arabic: 'Ù„Ø§', english: 'No', transliteration: 'la', source: 'phrases' },
                { arabic: 'ÙƒÙØªÙØ§Ø¨', english: 'Book', transliteration: 'kitab', source: 'school' },
                { arabic: 'Ù…ÙØ§Ø¡', english: 'Water', transliteration: 'maa\'', source: 'food_and_drink' },
                { arabic: 'Ø¨ÙÙŠÙ’Øª', english: 'House', transliteration: 'bayt', source: 'house' },
                { arabic: 'Ø³ÙÙ„Ø§Ù…', english: 'Peace', transliteration: 'salam', source: 'greetings' },
                { arabic: 'ØµÙØ¨ÙØ§Ø­ Ø§Ù„Ø®ÙÙŠÙ’Ø±', english: 'Good morning', transliteration: 'sabah al-khayr', source: 'greetings' },
                { arabic: 'Ø£ÙØ¨', english: 'Father', transliteration: 'ab', source: 'family' },
                { arabic: 'Ø£ÙÙ…', english: 'Mother', transliteration: 'umm', source: 'family' },
                { arabic: 'ÙˆÙØ§Ø­ÙØ¯', english: 'One', transliteration: 'wahid', source: 'numbers' },
                { arabic: 'Ø§ÙØ«Ù’Ù†ÙØ§Ù†', english: 'Two', transliteration: 'ithnan', source: 'numbers' },
                { arabic: 'Ø«ÙÙ„ÙØ§Ø«ÙØ©', english: 'Three', transliteration: 'thalatha', source: 'numbers' },
                { arabic: 'Ø£ÙØ­Ù’Ù…ÙØ±', english: 'Red', transliteration: 'ahmar', source: 'colors' },
                { arabic: 'Ø£ÙØ²Ù’Ø±ÙÙ‚', english: 'Blue', transliteration: 'azraq', source: 'colors' },
                { arabic: 'Ù‚ÙØ·ÙÙ‘Ø©', english: 'Cat', transliteration: 'qitta', source: 'animals' },
                { arabic: 'ÙƒÙÙ„Ù’Ø¨', english: 'Dog', transliteration: 'kalb', source: 'animals' },
                { arabic: 'ÙŠÙØ£Ù’ÙƒÙÙ„', english: 'Eat', transliteration: 'ya\'kul', source: 'verbs' },
                { arabic: 'ÙŠÙØ´Ù’Ø±ÙØ¨', english: 'Drink', transliteration: 'yashrab', source: 'verbs' }
            ];
            updateCategoryAvailability();
            filterWords();
            displayRandomWord();
        }

        // è¿‡æ»¤å•è¯ï¼ˆæ’é™¤å·²æŒæ¡çš„ï¼‰
        function filterWords() {
            const masteredSet = new Set(masteredWords.map(w => w.arabic));

            wordCache = allWords.filter(word => {
                // æ’é™¤å·²æŒæ¡çš„
                if (masteredSet.has(word.arabic)) return false;
                // æŒ‰åˆ†ç±»è¿‡æ»¤
                if (currentCategory !== 'all' && word.source !== currentCategory) return false;
                return true;
            });

            updateStats();
        }

        // æ˜¾ç¤ºéšæœºå•è¯
        function displayRandomWord() {
            showLoading(false);

            if (wordCache.length === 0) {
                document.getElementById('arabic-word').textContent = 'ğŸ‰';
                document.getElementById('transliteration').textContent = '';
                document.getElementById('phonetic').textContent = '';
                document.getElementById('chinese-meaning').textContent = 'å…¨éƒ¨æŒæ¡äº†ï¼';
                document.getElementById('english-meaning').textContent = 'All mastered!';
                document.getElementById('category').textContent = 'å®Œæˆ';
                return;
            }

            const randomIndex = Math.floor(Math.random() * wordCache.length);
            currentWord = wordCache[randomIndex];

            document.getElementById('arabic-word').textContent = currentWord.arabic || '---';
            const phoneticText = currentWord.phonetic || currentWord.transliteration || roughTransliteration(currentWord.arabic);
            document.getElementById('transliteration').textContent = currentWord.transliteration || phoneticText || '---';
            document.getElementById('phonetic').textContent = phoneticText ? `/${phoneticText}/` : '---';
            document.getElementById('english-meaning').textContent = currentWord.english || '---';

            const chineseMeaning = translateToChinese(currentWord.english);
            document.getElementById('chinese-meaning').textContent = chineseMeaning;

            const category = currentWord.source || 'vocabulary';
            document.getElementById('category').textContent = categoryTranslations[category] || category;

            sessionCount++;
            document.getElementById('session-count').textContent = sessionCount;
            document.getElementById('word-counter').textContent = `ç¬¬ ${sessionCount} ä¸ªå•è¯`;

            updateStats();
        }

        // ç¿»è¯‘æˆä¸­æ–‡
        function translateToChinese(english) {
            if (!english) return '---';
            const lowerEnglish = english.toLowerCase().trim();

            if (englishToChineseMap[lowerEnglish]) {
                return englishToChineseMap[lowerEnglish];
            }

            for (const [eng, chi] of Object.entries(englishToChineseMap)) {
                if (lowerEnglish.includes(eng) || eng.includes(lowerEnglish)) {
                    return chi;
                }
            }

            return english;
        }

        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('word-content').style.display = show ? 'none' : 'block';
        }

        function getArabicVoice() {
            const voices = window.speechSynthesis.getVoices();
            return voices.find(v =>
                v.lang.startsWith('ar') ||
                v.name.toLowerCase().includes('arabic') ||
                v.name.includes('Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©')
            );
        }

        function getChineseVoice() {
            const voices = window.speechSynthesis.getVoices();
            return voices.find(v =>
                v.lang.startsWith('zh') ||
                v.name.toLowerCase().includes('chinese') ||
                v.name.includes('ä¸­æ–‡')
            );
        }

        function getAudioUrl(word) {
            return word?.audio || word?.audio_url || word?.sound || word?.sound_url || word?.mp3 || null;
        }

        function cancelSpeechAndAudio() {
            window.speechSynthesis.cancel();
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
        }

        function speakText(text, options = {}) {
            return new Promise((resolve) => {
                if (!text) {
                    resolve();
                    return;
                }
                const utterance = new SpeechSynthesisUtterance(text);
                if (options.voice) {
                    utterance.voice = options.voice;
                    utterance.lang = options.voice.lang;
                } else if (options.lang) {
                    utterance.lang = options.lang;
                }
                utterance.rate = options.rate ?? speechRate;
                utterance.pitch = 1;
                utterance.volume = 1;
                utterance.onend = resolve;
                utterance.onerror = resolve;
                window.speechSynthesis.speak(utterance);
            });
        }

        function playAudioUrl(url) {
            return new Promise((resolve) => {
                if (!url) {
                    resolve();
                    return;
                }
                audioPlayer.src = url;
                audioPlayer.onended = resolve;
                audioPlayer.onerror = resolve;
                const playPromise = audioPlayer.play();
                if (playPromise?.catch) {
                    playPromise.catch(() => resolve());
                }
            });
        }

        function roughTransliteration(arabic) {
            if (!arabic) return '';
            const map = {
                'Ø§': 'a', 'Ø£': 'a', 'Ø¥': 'i', 'Ø¢': 'aa', 'Ø¨': 'b', 'Øª': 't', 'Ø«': 'th',
                'Ø¬': 'j', 'Ø­': 'h', 'Ø®': 'kh', 'Ø¯': 'd', 'Ø°': 'dh', 'Ø±': 'r', 'Ø²': 'z',
                'Ø³': 's', 'Ø´': 'sh', 'Øµ': 's', 'Ø¶': 'd', 'Ø·': 't', 'Ø¸': 'z', 'Ø¹': '\'',
                'Øº': 'gh', 'Ù': 'f', 'Ù‚': 'q', 'Ùƒ': 'k', 'Ù„': 'l', 'Ù…': 'm', 'Ù†': 'n',
                'Ù‡': 'h', 'Ùˆ': 'w', 'ÙŠ': 'y', 'Ø©': 'h', 'Ù‰': 'a', 'Ø¡': '\'',
                'Ø¤': '\'', 'Ø¦': '\'', 'Ù€': ''
            };
            let result = '';
            for (const ch of arabic) {
                if (ch === ' ') {
                    result += ' ';
                } else if (map[ch] !== undefined) {
                    result += map[ch];
                } else if (/[^\u0600-\u06FF]/.test(ch)) {
                    result += '';
                } else {
                    result += ch;
                }
            }
            return result.replace(/\s+/g, ' ').trim();
        }

        // æ’­æ”¾é˜¿æ‹‰ä¼¯è¯­ - ä¼˜å…ˆä½¿ç”¨éŸ³é¢‘ï¼Œå¤‡ç”¨è¯­éŸ³åˆæˆ
        async function playArabic() {
            const arabicWord = document.getElementById('arabic-word').textContent;
            if (!arabicWord || arabicWord === '---' || arabicWord === 'ğŸ‰') return;

            cancelSpeechAndAudio();
            const audioUrl = getAudioUrl(currentWord);

            const btn = document.getElementById('btn-play-arabic');
            btn.classList.add('playing');
            if (audioUrl) {
                await playAudioUrl(audioUrl);
                btn.classList.remove('playing');
                return;
            }

            const arabicVoice = getArabicVoice();
            await speakText(arabicWord, { voice: arabicVoice, lang: arabicVoice ? undefined : 'ar-SA' });
            btn.classList.remove('playing');
        }

        // æ’­æ”¾éŸ³è¯‘ï¼ˆä½œä¸ºå¤‡é€‰ï¼‰
        function playTransliteration() {
            const transliteration = document.getElementById('transliteration').textContent;
            if (!transliteration || transliteration === '---') return;

            speakText(transliteration, { lang: 'en-US' });
        }

        // æ’­æ”¾ä¸­æ–‡
        async function playChinese() {
            const chineseMeaning = document.getElementById('chinese-meaning').textContent;
            if (!chineseMeaning || chineseMeaning === '---') return;

            cancelSpeechAndAudio();
            const chineseVoice = getChineseVoice();

            const btn = document.getElementById('btn-play-chinese');
            btn.classList.add('playing');
            await speakText(chineseMeaning, { voice: chineseVoice, lang: chineseVoice ? undefined : 'zh-CN' });
            btn.classList.remove('playing');
        }

        // æ’­æ”¾è‹±æ–‡
        async function playEnglish() {
            const englishMeaning = document.getElementById('english-meaning').textContent;
            if (!englishMeaning || englishMeaning === '---') return;

            await speakText(englishMeaning, { lang: 'en-US' });
        }

        // åŠ è½½è¯­éŸ³åˆ—è¡¨
        window.speechSynthesis.onvoiceschanged = () => {
            const voices = window.speechSynthesis.getVoices();
            console.log('å¯ç”¨è¯­éŸ³:', voices.map(v => `${v.name} (${v.lang})`));
        };

        // åŠ è½½æ–°å•è¯
        function loadNewWord() {
            if (wordCache.length > 0) {
                displayRandomWord();
            } else {
                showToast('å½“å‰åˆ†ç±»å·²å…¨éƒ¨æŒæ¡ï¼');
            }
        }

        // æ ‡è®°ä¸ºå·²æŒæ¡
        function markAsMastered() {
            if (!currentWord) return;

            // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡
            const exists = masteredWords.some(w => w.arabic === currentWord.arabic);
            if (exists) {
                showToast('è¿™ä¸ªå•è¯å·²ç»æŒæ¡äº†');
                loadNewWord();
                return;
            }

            // æ·»åŠ åˆ°å·²æŒæ¡åˆ—è¡¨
            masteredWords.push({
                arabic: currentWord.arabic,
                english: currentWord.english,
                chinese: translateToChinese(currentWord.english),
                transliteration: currentWord.transliteration
            });

            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('masteredWords', JSON.stringify(masteredWords));

            // æ›´æ–°ç•Œé¢
            updateMasteredList();
            filterWords();

            showToast(`âœ… å·²æŒæ¡: ${currentWord.arabic}`);

            // æ˜¾ç¤ºä¸‹ä¸€ä¸ªå•è¯
            loadNewWord();
        }

        // æ›´æ–°å·²æŒæ¡åˆ—è¡¨æ˜¾ç¤º
        function updateMasteredList() {
            const container = document.getElementById('mastered-list');

            if (masteredWords.length === 0) {
                container.innerHTML = '<p style="color:#a0a0a0;">è¿˜æ²¡æœ‰æŒæ¡çš„å•è¯ï¼Œç‚¹å‡»"å·²æŒæ¡"æ·»åŠ </p>';
                return;
            }

            container.innerHTML = masteredWords.map((word, index) => `
                <div class="mastered-item">
                    <span class="arabic">${word.arabic}</span>
                    <span class="chinese">${word.chinese}</span>
                    <button class="remove-btn" onclick="removeMastered(${index})" title="ç§»é™¤">Ã—</button>
                </div>
            `).join('');
        }

        // ç§»é™¤å·²æŒæ¡çš„å•è¯
        function removeMastered(index) {
            const word = masteredWords[index];
            masteredWords.splice(index, 1);
            localStorage.setItem('masteredWords', JSON.stringify(masteredWords));
            updateMasteredList();
            filterWords();
            showToast(`å·²ç§»é™¤: ${word.arabic}`);
        }

        // æ¸…ç©ºæ‰€æœ‰å·²æŒæ¡
        function clearMastered() {
            if (masteredWords.length === 0) return;

            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å·²æŒæ¡çš„å•è¯å—ï¼Ÿ')) {
                masteredWords = [];
                localStorage.setItem('masteredWords', JSON.stringify(masteredWords));
                updateMasteredList();
                filterWords();
                showToast('å·²æ¸…ç©ºæ‰€æœ‰æŒæ¡è®°å½•');
            }
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('mastered-count').textContent = masteredWords.length;
            document.getElementById('remaining-count').textContent = wordCache.length;
            document.getElementById('total-count').textContent = allWords.length;

            // æ›´æ–°è¿›åº¦æ¡
            if (allWords.length > 0) {
                const progress = (masteredWords.length / allWords.length) * 100;
                document.getElementById('progress-fill').style.width = progress + '%';
            }
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('show');
            void toast.offsetWidth; // è§¦å‘é‡ç»˜
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // è‡ªåŠ¨æ’­æ”¾
        function toggleAutoPlay() {
            const btn = document.getElementById('btn-auto');

            if (isAutoPlaying) {
                stopAutoPlay();
                btn.classList.remove('active');
                btn.innerHTML = 'â–¶ï¸ è‡ªåŠ¨æ’­æ”¾';
            } else {
                startAutoPlay();
                btn.classList.add('active');
                btn.innerHTML = 'â¸ï¸ æš‚åœ';
            }
        }

        function startAutoPlay() {
            isAutoPlaying = true;
            autoPlayLoop();
        }

        function stopAutoPlay() {
            isAutoPlaying = false;
            if (autoPlayTimer) {
                clearTimeout(autoPlayTimer);
                autoPlayTimer = null;
            }
            cancelSpeechAndAudio();
        }

        function waitMs(ms) {
            return new Promise(resolve => {
                autoPlayTimer = setTimeout(resolve, ms);
            });
        }

        async function playCurrentWord() {
            cancelSpeechAndAudio();

            switch (playMode) {
                case 'arabic-chinese':
                    await playArabic();
                    await waitMs(400);
                    await playChinese();
                    break;
                case 'chinese-arabic':
                    await playChinese();
                    await waitMs(400);
                    await playArabic();
                    break;
                case 'arabic-only':
                    await playArabic();
                    break;
                case 'all':
                    await playArabic();
                    await waitMs(300);
                    await playEnglish();
                    await waitMs(300);
                    await playChinese();
                    break;
            }
        }

        async function autoPlayLoop() {
            while (isAutoPlaying) {
                await playCurrentWord();
                if (!isAutoPlaying) break;
                await waitMs(playInterval * 1000);
                if (!isAutoPlaying) break;
                loadNewWord();
            }
        }

        // æ›´æ–°è®¾ç½®
        function updateInterval() {
            playInterval = parseInt(document.getElementById('interval-slider').value);
            document.getElementById('interval-value').textContent = playInterval + 'ç§’';

            if (isAutoPlaying) {
                stopAutoPlay();
                startAutoPlay();
            }
        }

        function updateSpeed() {
            speechRate = parseFloat(document.getElementById('speed-slider').value);
            document.getElementById('speed-value').textContent = speechRate + 'x';
        }

        function updatePlayMode() {
            playMode = document.getElementById('play-mode').value;
        }

        // å¼€è½¦æ¨¡å¼
        function toggleDrivingMode() {
            isDrivingMode = !isDrivingMode;
            const btn = document.getElementById('driving-mode-btn');

            if (isDrivingMode) {
                document.body.classList.add('driving-mode');
                btn.textContent = 'å¼€å¯';
                btn.classList.add('active');
            } else {
                document.body.classList.remove('driving-mode');
                btn.textContent = 'å…³é—­';
                btn.classList.remove('active');
            }
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case ' ':
                    e.preventDefault();
                    toggleAutoPlay();
                    break;
                case 'ArrowRight':
                case 'n':
                    loadNewWord();
                    break;
                case 'a':
                    playArabic();
                    break;
                case 'c':
                    playChinese();
                    break;
                case 'm':
                    markAsMastered();
                    break;
            }
        });

        // è§¦æ‘¸æ»‘åŠ¨æ”¯æŒ
        let touchStartX = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const diff = touchEndX - touchStartX;

            if (Math.abs(diff) > 100) {
                if (diff > 0) {
                    playCurrentWord();
                } else {
                    loadNewWord();
                }
            }
        });
    </script>
</body>
</html>
